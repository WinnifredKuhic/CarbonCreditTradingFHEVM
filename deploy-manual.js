import { ethers } from "ethers";

// Simple deployment script without Hardhat compilation
async function deployContract() {
    // Contract bytecode and ABI (you'll need to compile this manually or use Remix)
    const contractBytecode = "0x608060405234801561001057600080fd5b50600080546001600160a01b03191633178155600181905560028190556001600160a01b031660009081526004602052604090208054600160ff199091161790556127108061005f6000396000f3fe608060405234801561001057600080fd5b50600436106101375760003560e01c80635a7dd27c116100b8578063a98048df1161007c578063a98048df14610288578063c33fb798146102a5578063d1ce59a7146102bd578063d311636b146102c5578063e5382d791461032e578063fc00b79814610336578063f731fa0f1461033e57600080fd5b80635a7dd27c1461022257806374d9f98f146102425780637c3772231461025557806382ad56cb146102695780638da5cb5b1461027c57600080fd5b80631a3b17a9116100ff5780631a3b17a9146101ac57806320d98d74146101b4578063260f8a1b146101c757806326224c64146101da578063436693d5146101f75780634d3820eb1461020a57600080fd5b806302d2838b1461013c5780630a0c4b0b14610151578063163f7522146101645780631654c07114610186578063175283231461019e575b600080fd5b61014f61014a36600461239d565b610361565b005b61014f61015f3660046123b6565b6104c7565b6101776101723660046123f1565b610562565b60405190151581526020015b60405180910390f35b61018e610593565b60405190815260200161017d565b61018e6101ac366004612412565b6105a0565b6101776105b1565b61014f6101c2366004612441565b6105ca565b61014f6101d53660046123f1565b6106ca565b6101ed6101e83660046123f1565b610746565b60405161017d9493929190612483565b61014f6102053660046123f1565b6107aa565b61014f61021836600461239d565b610836565b61023561023036600461239d565b610957565b60405161017d91906124bf565b61014f610250366004612502565b610a53565b61026861026336600461239d565b610b95565b60405161017d959493929190612575565b6102356102773660046123f1565b610c72565b600054610177906001600160a01b031681565b610177610296366004612412565b6001600160401b0316151590565b61014f6102b33660046125dc565b610cdd565b610268610d66565b6102f36102d336600461239d565b600090815260056020526040902080546001820154600682015460079092015490919060ff1682565b604080516001600160a01b0395861681529490931660208501529115159083015260608201526080810191909152519081900360a00161017d565b61018e600254565b610235610d8b565b610177610296366004612412565b61014f36600461239d565b600054600090600160a01b900460ff16156103c35760405162461bcd60e51b815260206004820152601760248201527f5265656e7472616e637947756172643a207265656e7472616e7400000000000060448201526064015b60405180910390fd5b6000546001600160a01b0316331461041d5760405162461bcd60e51b815260206004820152600d60248201527f4e6f7420617574686f72697a6564000000000000000000000000000000000000604482015260640161022c565b6000828152600560205260409020600681015460ff166104755760405162461bcd60e51b815260206004820152601060248201527f4f72646572206e6f742061637469766500000000000000000000000000000000604482015260640161022c565b6006810154610100900460ff16156104c35760405162461bcd60e51b815260206004820152601760248201527f4f7264657220616c72656164792066756c66696c6c6564000000000000000000604482015260640161022c565b5050565b600054600160a01b900460ff16156105215760405162461bcd60e51b815260206004820152601760248201527f5265656e7472616e637947756172643a207265656e7472616e74000000000000604482015260640161022c565b60005460ff16600160a01b1715801561054757506001600160a01b038216600090815260036020526040902054155b1561055e576001600160a01b03821660009081526003602052604090206001905590565b5050565b6001600160a01b038116600090815260036020526040812054801561058b5760019150506105ea565b506000919050565b6001805461058b9190612622565b6001818154811061039357005b50600101545b6001600160a01b03166000908152600360205260409020541590565b6000546001600160a01b031633146106245760405162461bcd60e51b815260206004820152600d60248201527f4e6f7420617574686f72697a6564000000000000000000000000000000000000604482015260640161022c565b6001600160a01b038316600090815260036020526040902054156106be5760405162461bcd60e51b8152602060048201526024808201527f557365722068617320616c72656164792072656769737465726564207769746860448201527f2075730000000000000000000000000000000000000000000000000000000000606482015260840161022c565b6001600160a01b0383166000908152600360205260409020829055604080513381526001600160a01b0385166020820152908101839052606001604051809103902080548061070e576107106126e5565b60019003818190600052602060002001600090559055600181018290555050565b600380546001600160a01b038416600090815260036020526040812054919350909183610779576107796126e5565b60009182526020909120015480546001820154600283015460039093015491939092906001600160401b03169060ff1685565b600054600160a01b900460ff16156108045760405162461bcd60e51b815260206004820152601760248201527f5265656e7472616e637947756172643a207265656e7472616e74000000000000604482015260640161022c565b6001600160a01b0381166000908152600460205260409020805460ff1916600117905560405133906001600160a01b038316907f8b4006ca14f23d4e7aa8d120d1ab7c3761d650eefac1a5d6732dbea94b54ea2490600090a350565b600054600160a01b900460ff16156108905760405162461bcd60e51b815260206004820152601760248201527f5265656e7472616e637947756172643a207265656e7472616e74000000000000604482015260640161022c565b3360009081526003602052604090205461090f576040516001600160401b0319606083901b166020820152600090603401604051602081830303815290604052805190602001209050336000908152600360205260409020819055600190505b600060405180606001604052806108fc8888604051602001610934929190612716565b6040516020818303038152906040528051906020012060ff16610b59565b6001600160401b031681526020810191909152604001600281525060ff908116909103906001600160401b03165b6000815181526005602090815260409182902083518154928501519390920151606090920151608090920151610100600686901b1b90959094171617909255805160018201559190930151909255600280549193509061050d908490612622565b60008281526005602090815260409182902082518154928401519184015160608501516080909501516001600160a01b039586166001600160d01b031990941693909317600160a01b6001600160401b03909316929092029190911760ff60e01b1916600160e01b9215159290920291909117808255600182015560028101929092556003820191909155600490910155505050565b600054600160a01b900460ff1615610aad5760405162461bcd60e51b815260206004820152601760248201527f5265656e7472616e637947756172643a207265656e7472616e74000000000000604482015260640161022c565b336000908152600360205260409020548015610ae45760008181526005602052604090208054610adc90612746565b505092915050565b610aed8361012c565b604051633416cc7360e11b81526001600160a01b03851660248201526001600160401b0384166044820152336064820152608401604051809103906000fd5b60606001805480602002602001604051908101604052809291908181526020018280548015610b8b57602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311610b6d575b5050505050905090565b600081815260056020908152604091829020825160a081018452815463ffffffff808216835260801c1660208201526001820154928101929092526002810154606083015260038101546080830152919291829160019160e01c900460ff161590565b6000805b600354811015610c6a576003818154811061015157610151612760565b600080546040516001600160a01b0390911690600160a01b900460ff168061028657610286612760565b6000838152600560209081526040808320815160a08101835281546001600160a01b038116825260a081901c6001600160401b0316958201959095526001820154928101929092526002810154606083015260038101546080830152909186918601869190600160e01b900460ff161515610321575050505b90505b60008080808060005b8751811015610a3d5760008882815181106103fa576103fa612760565b60209081029190910101518054600190910154909150600090888888881a8b01878c8151811061042c5761042c612760565b60209081029190910181015160408051928301959095528101919091526001600160401b0316606082015260808101939093529091506001600160a01b038a1660a0820152600160c0820152600160e082015261010081018890526000906101200160405160208183030381529060405280519060200120905086516000906120009083906104b9906126e5565b60009081526020919091526040812060018101548254919550945050600160e01b900460ff16156105b8576001840154610556578760018501558554600160e01b60ff60e01b199091161786555b60008681526005602052604090206003015460ff161590505b50600195945050505050565b90565b61055e8260009081526005602052604090206001015461058b565b60008281526005602052604081208054600160e01b900460ff161561062a575050600092915050565b5050600191505b50919050565b8261064e57600080fd5b60008181526005602052604090208054600160e01b900460ff161561066c57600091505b81610678575050565b60008281526005602052604090206002015461069390610b95565b6000838152600560205260409020600301805460ff19169055505050565b5050600191505b92915050565b505050565b505050565b600080fd5b565b60005b8381101561070a5781810151838201526020016106f2565b838111156106bf57506000910152565b600081518084526107328160208601602086016106ef565b601f01601f19169290920160200192915050565b600060a08201905083518252602084015163ffffffff8082166020850152806040870151166040850152505060608401516001600160401b0380821660608501528060808701511660808501525092915050565b6001600160a01b038116811461079157005b50565b803561070a81610776565b60008060408385031215610b9e57600080fd5b6001600160401b03811681146107b357600080fd5b8035610bc8816107ae565b919050565b600080600060608486031215610be257600080fd5b8335610bed81610776565b9250610bfb60208501610bb3565b9150610c0960408501610bb3565b90509250925092565b600060208284031215610c2457600080fd5b81356105d981610776565b600060208284031215610c4157600080fd5b5035919050565b634e487b7160e01b600052604160045260246000fd5b60405160a0810167ffffffffffffffff81118282101715610c8157610c81610c48565b60405290565b604051601f8201601f1916810167ffffffffffffffff81118282101715610cb057610cb0610c48565b604052919050565b600067ffffffffffffffff821115610cd257610cd2610c48565b5060051b60200190565b600082601f830112610ced57600080fd5b81356020610d02610cfd83610cb8565b610c87565b82815260a09283028501820192828201919087851115610d2157600080fd5b8387015b85811015610d79578135870160a0811215610d3f57600080fd5b610d47610c5e565b8135610d5281610776565b8152610d5f868301610bb3565b86820152604082013560408201526060820135606082015260808201356080820152845292840192810190610d25565b5090979650505050505050565b600060208284031215610d9857600080fd5b813567ffffffffffffffff811115610daf57600080fd5b610dbb84828501610cd6565b949350505050565b60208152600061071a602083018461071a565b600080600060608486031215610deb57600080fd5b8335610df681610776565b92506020840135610e0681610776565b9150604084013563ffffffff81168114610e1f57600080fd5b809150509250925092565b60008060408385031215610e3d57600080fd5b8235610e4881610776565b946020939093013593505050565b60008151808452602080850194506020840160005b83811015610e905781516001600160a01b031687529582019590820190600101610e6b565b509495945050505050565b600060a0820190506001600160a01b038085511683526001600160401b036020860151166020840152604085015160408401526060850151606084015260808501511660808301529392505050565b600060208083526000845481600182811c915080831680610f0357607f831692505b858310811415610f2157634e487b7160e01b85526022600452602485fd5b878601838152602001818015610f3e5760018114610f4f57610f7a565b60ff19861682528782019650610f7a565b60008b81526020902060005b86811015610f745781548482015290850190890190610f5b565b83019750505b50949998505050505050505050565b8051825260006020820151610fa9602085018263ffffffff169052565b506040820151610fc4604085018263ffffffff169052565b50606082015160608401526080820151608084015292915050565b600060208252825160a0602084015263ffffffff80835116610100850152602083015116610120840152604083015161014084015260608301516101608401526080830151151561018084015260a08301516001600160a01b03811660e085015260c08401516101a085015260e08401516101c085015295810151959095019490945250919050565b600081518084526020808501945080840160005b838110156109b9578151875295820195908201906001016109b5565b6001600160a01b038616815284602082015283604082015260a06060820152600061109160a0830185610f89565b82810360808401526110a38185611065565b98975050505050505050565b6000602082840312156110c157600080fd5b815180151581146105d957600080fd5b634e487b7160e01b600052601160045260246000fd5b600082198211156110fa576110fa6110d1565b500190565b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052601260045260246000fd5b60008261113a5761113a611115565b500690565b60008261114e5761114e611115565b500490565b6000816111625761116261110c1565b5060010190565b60008282101561117b5761117b6110d1565b500390565b6000828210156111925761119261110d1565b500390565b60008160001904831182151516156111b1576111b16110d1565b500290565b600061ffff808316818114156111ce576111ce6110d1565b6001019392505050565b7f416363657373436f6e74726f6c3a206163636f756e742000000000000000000081526000835161121081601785016020880161071a565b7001034b99036b4b9b9b4b733903937b6329607d1b601791840191820152835161124181602884016020880161071a565b01602801949350505050565b60006001820161125f5761125f6110d1565b506001019056fea264697066735822122033da2b9b8b4f1f9b0b9b9b9b9b9b9b9b9b9b9b9b9b9b9b9b9b9b9b9b9b9b9b9b64736f6c63430008090033"; // This needs to be the compiled bytecode

    const contractABI = [
        {
            "inputs": [],
            "stateMutability": "nonpayable",
            "type": "constructor"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": true,
                    "internalType": "address",
                    "name": "user",
                    "type": "address"
                }
            ],
            "name": "BalanceUpdated",
            "type": "event"
        },
        {
            "inputs": [],
            "name": "registerUser",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "user",
                    "type": "address"
                }
            ],
            "name": "isUserRegistered",
            "outputs": [
                {
                    "internalType": "bool",
                    "name": "",
                    "type": "bool"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        }
    ];

    // Connect to local network
    const provider = new ethers.JsonRpcProvider("http://127.0.0.1:8546");
    const signer = await provider.getSigner();

    console.log("Deploying contract with account:", await signer.getAddress());
    console.log("Account balance:", (await provider.getBalance(await signer.getAddress())).toString());

    // Create contract factory
    const contractFactory = new ethers.ContractFactory(contractABI, contractBytecode, signer);

    // Deploy the contract
    console.log("Deploying contract...");
    const contract = await contractFactory.deploy();

    console.log("Waiting for deployment transaction...");
    await contract.waitForDeployment();

    const contractAddress = await contract.getAddress();
    console.log("Contract deployed to:", contractAddress);

    return contractAddress;
}

// Run deployment
deployContract()
    .then((address) => {
        console.log("\n🎉 Deployment successful!");
        console.log(`📝 Update CONTRACT_ADDRESS in app.js to: ${address}`);
        process.exit(0);
    })
    .catch((error) => {
        console.error("Deployment failed:", error);
        process.exit(1);
    });